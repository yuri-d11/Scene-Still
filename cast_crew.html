<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Cast &amp; Crew</title>
		<link href="css/bootstrap-4.4.1.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">
		<link href="css/cast_crew.css" rel="stylesheet">
	</head>

	<body>
		<div class="wrapper">
			<nav>
				<ul class="nav-list">
				  <li><a href="index.html">Films</a></li>
				  <li><a href="cast_crew.html" aria-current="page">Cast &amp; Crew</a></li>
				  <li><a href="contact.html">Contact</a></li>
				</ul>
				<form class="search-form" action="#" method="get">
					<input type="text" placeholder="Search by film or person..." name="search" class="search-input" id="search-input">
				</form>
			</nav>
			<h1>Scene Still</h1>
			<h4>A handpicked gallery of high quality film screencaptures that highlight the visual language of cinema and the power of storytelling through composition, light, and color.</h4>
			<div class="column-grid" id="cast-crew-grid">  
				<div class="column-block">
					<h5>Cinematographers</h5>
					<ul class="name-list" id="cinematographers-list">
					</ul>
				</div>
				<div class="column-block">
					<h5>Directors</h5>
					<ul class="name-list" id="directors-list">
					</ul>
				</div>
				<div class="column-block">
					<h5>Cast</h5>
					<ul class="name-list" id="cast-list">
					</ul>
				</div>
			</div>
			<h4 class="search-results-header" style="display: none; margin-top: 10px;">Search Results:</h4>
			<div class="image-container" id="film-cards-container" style="display: none;">
			</div>
		</div>
    <footer>
		<hr>
		<p>by Yuri Dandashi | <a href="contact.html">Contact</a></p>
	</footer>
	<script src="utils/utils-http.js"></script>
	<script src="utils/utils-csv.js"></script>
	<script src="utils/utils-cache.js"></script>
	<script src="utils/utils-tmdb.js"></script>
	<script src="js/load-films.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', async () => {
			const movieIds = [];
			const csvText = await window.SZ.http.fetchWithRetry('Scene still DB - Sheet1.csv');
			const csvData = window.SZ.csv.parseCSVToObjects(csvText.text);
			csvData.forEach(row => {
				if (row['Movie ID']) {
					movieIds.push(parseInt(row['Movie ID']));
				}
			});

			const directors = new Set();
			const cinematographers = new Set();
			const cast = new Set();

			const movieDetailsPromises = movieIds.map(movieId => window.SZ.tmdb.getMovieDetails(movieId));
			const allMovieDetails = await Promise.all(movieDetailsPromises);

			allMovieDetails.forEach(movieDetails => {
				if (movieDetails && movieDetails.credits) {
					// Directors
					movieDetails.credits.crew.filter(p => p.job === 'Director').forEach(p => directors.add(p.name));
					// Cinematographers
					movieDetails.credits.crew.filter(p => p.job === 'Director of Photography').forEach(p => cinematographers.add(p.name));
					// Cast
					movieDetails.credits.cast.slice(0, 5).forEach(p => cast.add(p.name)); // Top 5 cast members
				}
			});

			const sortedDirectors = Array.from(directors).sort();
			const sortedCinematographers = Array.from(cinematographers).sort();
			const sortedCast = Array.from(cast).sort();

			const createPersonListItem = (name, role) => {
				const li = document.createElement('li');
				const a = document.createElement('a');
				// Function to convert special characters to ASCII equivalents for filenames
				const sanitizeNameForUrl = (personName) => {
					return personName
						.toLowerCase()
						.replace(/[äöü]/g, (c) => ({'ä': 'a', 'ö': 'o', 'ü': 'u'}[c])) // Replace German umlauts
						.replace(/[éáíóú]/g, (c) => ({'é': 'e', 'á': 'a', 'í': 'i', 'ó': 'o', 'ú': 'u'}[c])) // Replace acute accents
						.replace(/ō/g, 'o') // Replace romaji 'ō'
						.replace(/[^a-z0-9]+/g, '_') // Replace non-alphanumeric with underscore
						.replace(/^_+|_+$/g, ''); // Trim leading/trailing underscores
				};
				a.href = `person.html?name=${encodeURIComponent(name)}&role=${encodeURIComponent(role)}`;
				a.textContent = name;
				li.appendChild(a);
				return li;
			};

			const directorsList = document.getElementById('directors-list');
			const cinematographersList = document.getElementById('cinematographers-list');
			const castList = document.getElementById('cast-list');

						sortedDirectors.forEach(name => directorsList.appendChild(createPersonListItem(name, 'Director')));
			sortedCinematographers.forEach(name => cinematographersList.appendChild(createPersonListItem(name, 'Cinematographer')));
			sortedCast.forEach(name => castList.appendChild(createPersonListItem(name, 'Actor')));
		});

		// Initialize search functionality
		window.SZ.searchManager.initializeSearch({
			searchInputId: 'search-input',
			filmCardsContainerId: 'film-cards-container',
			mainContentSelector: '#cast-crew-grid, .wrapper > h1, .wrapper > h4:not(.search-results-header)'
		});
	</script>
	</body>
</html>