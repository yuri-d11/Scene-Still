<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon.png">
    <title id="page-title">Film Gallery | Scene Still</title>
    <meta name="description" id="meta-description" content="Handpicked high quality film screencaptures. Explore the visual language of cinema through composition, light, and color.">
    <meta name="keywords" content="film stills, movie screencaptures, cinematography, high quality stills, movie screenshots">
    <link rel="canonical" href="" id="canonical-url">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" id="og-type">
    <meta property="og:url" content="" id="og-url">
    <meta property="og:title" content="Film Gallery | Scene Still" id="og-title">
    <meta property="og:description" content="Handpicked high quality film screencaptures. Explore the visual language of cinema through composition, light, and color." id="og-description">
    <meta property="og:image" content="" id="og-image">
    <meta property="og:site_name" content="Scene Still">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" id="twitter-card">
    <meta property="twitter:url" content="" id="twitter-url">
    <meta property="twitter:title" content="Film Gallery | Scene Still" id="twitter-title">
    <meta property="twitter:description" content="Handpicked high quality film screencaptures. Explore the visual language of cinema through composition, light, and color." id="twitter-description">
    <meta property="twitter:image" content="" id="twitter-image">
    <meta property="twitter:creator" content="@YuriDandashi">
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" >
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/film.css">

</head>

<body>
    <div class="wrapper">
        <nav>
			<ul class="nav-list">
			  <li><a href="index.html">Films</a></li>
			  <li><a href="cast_crew.html">Cast &amp; Crew</a></li>
			  <li><a href="color_extractor.html">Color Extractor</a></li>
			  <li><a href="about.html">About</a></li>
			</ul>
			<form class="search-form" action="#" method="get">
                <input type="text" placeholder="Search by film or person..." name="search" class="search-input" id="search-input">
            </form>
		</nav>
        
        <h1 id="movie-title">&emsp;</h1>
        <div class="credits-container">
            <div class="credit-line">
                <span class="credit-title">Director:</span>
                <span class="credit-name" id="director"></span>
            </div>
            <div class="credit-line">
                <span class="credit-title">Cinematographer:</span>
                <span class="credit-name" id="cinematographer"></span>
            </div>
			<div class="credit-line">
                <span class="credit-title">Cast:</span>
                <span class="credit-name" id="cast"></span>
            </div>
        </div>
        <!-- Search Results Section -->
        <h4 class="search-results-header" style="display: none; margin-top: 10px;">Search Results:</h4>
        <div class="image-container" id="film-cards-container" style="display: none;">
        </div>

        <!-- Main Image -->
        <div class="mt-3" id="main-content">
            <img id="main-image" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Loading film still" class="img-fluid main-image-placeholder">
            <div id="main-palette-container" class="row no-gutters"></div>
        </div>
		
		<p id="thumbnail-instructions">Click one of the thumbnails below to select a main image.</p>
		
        <!-- Thumbnail Grid -->
		<div class="thumbnail-grid-wrapper">
			<div class="row thumbnail-grid" id="thumbnail-grid">
				<div class="col-lg-3 col-md-6 mb-4"><div class="thumbnail-wrapper"><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Thumbnail film still" class="thumbnail-image"></div></div>
            <div class="col-lg-3 col-md-6 mb-4"><div class="thumbnail-wrapper"><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Thumbnail film still" class="thumbnail-image"></div></div>
            <div class="col-lg-3 col-md-6 mb-4"><div class="thumbnail-wrapper"><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Thumbnail film still" class="thumbnail-image"></div></div>
            <div class="col-lg-3 col-md-6 mb-4"><div class="thumbnail-wrapper"><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Thumbnail film still" class="thumbnail-image"></div></div>
            <div class="col-lg-3 col-md-6 mb-4"><div class="thumbnail-wrapper"><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Thumbnail film still" class="thumbnail-image"></div></div>
            <div class="col-lg-3 col-md-6 mb-4"><div class="thumbnail-wrapper"><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Thumbnail film still" class="thumbnail-image"></div></div>
            <div class="col-lg-3 col-md-6 mb-4"><div class="thumbnail-wrapper"><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Thumbnail film still" class="thumbnail-image"></div></div>
            <div class="col-lg-3 col-md-6 mb-4"><div class="thumbnail-wrapper"><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Thumbnail film still" class="thumbnail-image"></div></div>
        </div>
		</div>
		<div class="slider-controls">
			<div class="slider-indicators" id="slider-indicators"></div>
			<span class="slider-hint">Click a side to show more images.</span>
		</div>
    </div>
        <footer class="wrapper">
                <hr>
                <p>by Yuri Dandashi | <a href="about.html">About</a></p>
        </footer>
	<div id="image-modal" class="modal-overlay">
                <span class="close-modal">&times;</span>
                <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Loading film still" class="modal-content" id="modal-image">
        </div>
    <script src="js/clean-urls.js"></script>
    <script src="js/color-palette.js"></script>
    <script src="js/lazy-load.js"></script>
    <script src="js/thumbnail-slider.js"></script>
    <script src="utils/utils-http.js"></script>
    <script src="utils/utils-csv.js"></script>
    <script src="js/load-csv.js"></script>
    <script src="utils/utils-cache.js"></script>
    <script src="utils/utils-tmdb.js"></script>
    <script src="js/load-films.js"></script>
        <script>
        // Update page title immediately with movie ID (before async operations)
        // This helps Google index the correct content
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get('id');
            if (movieId) {
                document.getElementById('page-title').textContent = `Film ${movieId} | Scene Still`;
            }
        })();
        
        async function populateMoviePage() {
            const urlParams = new URLSearchParams(window.location.search);
            const TMDB_MOVIE_ID = urlParams.get('id');

            if (!TMDB_MOVIE_ID) {
                document.getElementById('movie-title').textContent = 'Error: Movie ID not provided in URL';
                return;
            }

            if (!window.SZ || !window.SZ.tmdb) {
                document.getElementById('movie-title').textContent = 'Error: TMDb utils not loaded';
                return;
            }

            try {
                const movieDetails = await window.SZ.tmdb.getMovieDetails(TMDB_MOVIE_ID);
                if (!movieDetails) {
                    document.getElementById('movie-title').textContent = 'Movie not found on TMDb';
                    return;
                }

                document.getElementById('page-title').textContent = movieDetails.title + ' | Scene Still';
                document.getElementById('meta-description').content = movieDetails.title + ' â€“ handpicked high quality film screencaptures';
                document.getElementById('movie-title').textContent = `${movieDetails.title} (${new Date(movieDetails.release_date).getFullYear()})`;

                // Load stills from CSV first to get the first image for Open Graph
                const csvData = await window.SZ.utils.loadCsv('Scene still DB - Sheet1.csv');
                const movieEntry = csvData.find(row => row['Movie ID'] === String(TMDB_MOVIE_ID));

                let localStills = [];
                if (movieEntry && movieEntry.Stills) {
                    localStills = movieEntry.Stills.split('|');
                }

                // Update Open Graph tags
                const currentUrl = window.location.href;
                const ogTitle = `${movieDetails.title} (${new Date(movieDetails.release_date).getFullYear()})`;
                const ogDescription = `Handpicked high quality film screencaptures from ${movieDetails.title}. Explore the visual language of cinema through composition, light, and color.`;
                const ogImage = localStills.length > 0 ? localStills[0] : (movieDetails.poster_path ? `https://image.tmdb.org/t/p/original${movieDetails.poster_path}` : '');

                // Set canonical URL
                document.getElementById('canonical-url').setAttribute('href', currentUrl);
                
                document.getElementById('og-type').setAttribute('content', 'website');
                document.getElementById('og-url').setAttribute('content', currentUrl);
                document.getElementById('og-title').setAttribute('content', ogTitle);
                document.getElementById('og-description').setAttribute('content', ogDescription);
                document.getElementById('og-image').setAttribute('content', ogImage);

                document.getElementById('twitter-card').setAttribute('content', 'summary_large_image');
                document.getElementById('twitter-url').setAttribute('content', currentUrl);
                document.getElementById('twitter-title').setAttribute('content', ogTitle);
                document.getElementById('twitter-description').setAttribute('content', ogDescription);
                document.getElementById('twitter-image').setAttribute('content', ogImage);


                // Initialize search functionality
                window.SZ.searchManager.initializeSearch({
                    searchInputId: 'search-input',
                    filmCardsContainerId: 'film-cards-container',
                    mainContentSelector: '#main-content, #thumbnail-grid, .credits-container, .wrapper > h1, #thumbnail-instructions, .slider-controls'
                });

                // Director (assuming director is in crew)
                const director = movieDetails.credits?.crew?.find(person => person.job === 'Director');
                if (director) {
                    document.getElementById('director').innerHTML = `<a href="person.html?name=${encodeURIComponent(director.name)}&role=Director">${director.name}</a>`;
                } else {
                    document.getElementById('director').textContent = 'N/A';
                }

                // Cinematographer (Director of Photography)
                const cinematographer = movieDetails.credits?.crew?.find(person => person.job === 'Director of Photography');
                if (cinematographer) {
                    document.getElementById('cinematographer').innerHTML = `<a href="person.html?name=${encodeURIComponent(cinematographer.name)}&role=Cinematographer">${cinematographer.name}</a>`;
                } else {
                    document.getElementById('cinematographer').textContent = 'N/A';
                }

                // Cast
                const castContainer = document.getElementById('cast');
                const mainCast = movieDetails.credits?.cast?.slice(0, 5); // Get top 5 cast members
                if (mainCast && mainCast.length > 0) {
                    castContainer.innerHTML = mainCast.map(person => `<a href="person.html?name=${encodeURIComponent(person.name)}&role=Actor">${person.name}</a>`).join(', ');
                } else {
                    castContainer.textContent = 'N/A';
                }

                // Set aspect ratio for main image
                let aspectRatio = null;
                if (movieEntry && movieEntry['Aspect ratio']) {
                    aspectRatio = movieEntry['Aspect ratio'];
                    document.getElementById('main-image').style.aspectRatio = aspectRatio;
                }

                let compressedStills = [];
                if (movieEntry && movieEntry['Stills compressed']) {
                    compressedStills = movieEntry['Stills compressed'].split('|');
                }

                if (localStills.length > 0) {
                    const mainImage = document.getElementById('main-image');
                    // Always load full resolution for main image (loads first, before thumbnails)
                    mainImage.src = localStills[0];
                    mainImage.alt = `${movieDetails.title} 1`;
                    // SEO: Add structured data attributes to main image
                    mainImage.setAttribute('itemprop', 'image');
                } else {
                    document.getElementById('main-image').src = ''; // Placeholder or error image
                }

                // Thumbnails
                const grid = document.getElementById('thumbnail-grid');
                grid.innerHTML = '';
                localStills.forEach((still, index) => {
                    const col = document.createElement('div');
                    col.className = 'col-lg-3 col-md-6 mb-4'; // Changed to col-lg-3 for 4 columns per row
                    const wrap = document.createElement('div');
                    wrap.className = 'thumbnail-wrapper';
                    const img = document.createElement('img');
                    
                    // Use placeholder initially, store actual src in data attribute for lazy loading
                    img.src = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
                    img.className = 'thumbnail-image';
                    img.dataset.lazySrc = compressedStills[index] || still; // Use compressed still if available
                    img.dataset.fullSrc = still; // Store full resolution image URL
                    img.alt = `${movieDetails.title} ${index + 1}`;
                    
                    // SEO: Add srcset to tell search engines about full resolution version
                    // This will be removed after lazy loading to prevent loading high-res on devices
                    if (compressedStills[index]) {
                        img.setAttribute('srcset', `${compressedStills[index]} 800w, ${still} 1920w`);
                    }
                    
                    // SEO: Add itemprop for schema.org ImageObject
                    img.setAttribute('itemprop', 'image');
                    
                    wrap.appendChild(img);
                    col.appendChild(wrap);
                    grid.appendChild(col);
                });

                // Apply aspect ratio to thumbnails after they are created
                if (aspectRatio) {
                    document.querySelectorAll('.thumbnail-image').forEach(img => {
                        img.style.aspectRatio = aspectRatio;
                    });
                }

                // Initialize slider if needed (more than 16 images)
                if (window.SZ?.thumbnailSlider?.initializeSlider) {
                    window.SZ.thumbnailSlider.initializeSlider(localStills.length);
                }

                // Setup lazy loading for thumbnails
                if (window.SZ?.lazyLoad?.setupThumbnails) {
                    window.SZ.lazyLoad.setupThumbnails(localStills.length);
                }

                // Initialize color palette after images are set
                const mainImageElement = document.getElementById('main-image');
                const firstThumbnailWrapper = grid.querySelector('.thumbnail-wrapper');
                if (mainImageElement && firstThumbnailWrapper && window.SZ?.colorPalette?.updateMainImageAndPalette) {
                    window.SZ.colorPalette.updateMainImageAndPalette(mainImageElement.src, firstThumbnailWrapper);
                }

                // Modal functionality for main image
                const imageModal = document.getElementById('image-modal');
                const modalImage = document.getElementById('modal-image');
                const closeModal = document.querySelector('.close-modal');

                mainImageElement.addEventListener('click', () => {
                    modalImage.src = mainImageElement.src;
                    imageModal.style.display = 'block';
                });

                closeModal.addEventListener('click', () => {
                    imageModal.style.display = 'none';
                });

                imageModal.addEventListener('click', (event) => {
                    if (event.target === imageModal) {
                        imageModal.style.display = 'none';
                    }
                });

                // SEO: Add JSON-LD structured data for better Google Images indexing
                const structuredData = {
                    "@context": "https://schema.org",
                    "@type": "ImageGallery",
                    "name": `${movieDetails.title} (${new Date(movieDetails.release_date).getFullYear()}) - Film Stills`,
                    "description": `High quality screencaptures from ${movieDetails.title}`,
                    "about": {
                        "@type": "Movie",
                        "name": movieDetails.title,
                        "datePublished": movieDetails.release_date
                    },
                    "image": localStills.map((still, index) => ({
                        "@type": "ImageObject",
                        "contentUrl": still,
                        "name": `${movieDetails.title} ${index + 1}`,
                        "description": `Scene still ${index + 1} from ${movieDetails.title}`,
                        "thumbnail": compressedStills[index] || still
                    }))
                };
                
                // Inject structured data into page
                const script = document.createElement('script');
                script.type = 'application/ld+json';
                script.textContent = JSON.stringify(structuredData);
                document.head.appendChild(script);

            } catch (err) {
                document.getElementById('movie-title').textContent = 'Error loading movie data from TMDb';
                console.error(err);
            }
        }
        window.addEventListener('DOMContentLoaded', populateMoviePage);
        </script>
</body>
</html>
