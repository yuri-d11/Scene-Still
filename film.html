<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon.png">
    <title id="page-title">Film Gallery | Scene Still</title>
    <meta name="description" id="meta-description" content="Handpicked high quality film screencaptures. Explore the visual language of cinema through composition, light, and color.">
    <meta name="keywords" content="film stills, movie screencaptures, cinematography, high quality stills, movie screenshots">
    <link rel="canonical" href="" id="canonical-url">
    
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-QXMX7DRYJH"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-QXMX7DRYJH');
        </script>
    <!-- Prerendering hints for crawlers -->
    <meta name="fragment" content="!">
    <script type="application/ld+json" id="initial-structured-data"></script>
    
    <!-- Resource Hints -->
    <link rel="preconnect" href="https://api.themoviedb.org">
    <link rel="preconnect" href="https://image.tmdb.org">
    <link rel="dns-prefetch" href="https://api.themoviedb.org">
    <link rel="dns-prefetch" href="https://image.tmdb.org">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" id="og-type">
    <meta property="og:url" content="" id="og-url">
    <meta property="og:title" content="Film Gallery | Scene Still" id="og-title">
    <meta property="og:description" content="Handpicked high quality film screencaptures. Explore the visual language of cinema through composition, light, and color." id="og-description">
    <meta property="og:image" content="" id="og-image">
    <meta property="og:site_name" content="Scene Still">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" id="twitter-card">
    <meta property="twitter:url" content="" id="twitter-url">
    <meta property="twitter:title" content="Film Gallery | Scene Still" id="twitter-title">
    <meta property="twitter:description" content="Handpicked high quality film screencaptures. Explore the visual language of cinema through composition, light, and color." id="twitter-description">
    <meta property="twitter:image" content="" id="twitter-image">
    <meta property="twitter:creator" content="@YuriDandashi">
    
    <!-- Critical CSS - inline for instant render -->
    <style>
        @font-face{font-family:'Jost';src:url("fonts/Jost-VariableFont_wght.ttf") format('truetype');font-weight:100 900;font-style:normal;font-display:swap}
        body{font-family:Jost,sans-serif;background-color:#120D0D;margin:0;padding:0;min-height:100vh;display:flex;flex-direction:column}
        .wrapper{width:100%;max-width:1280px;margin:0 auto;padding:10px 50px;flex-grow:1}
        nav{display:flex;justify-content:space-between;align-items:center;background-color:transparent;padding:.5rem 0;flex-wrap:wrap;position:relative}
        .nav-list{list-style:none;display:flex;margin:0;padding:0;flex-wrap:wrap}
        .nav-list li{margin-right:30px}
        .nav-list li a{font-weight:400;font-size:16px;color:#FAFAFA;text-decoration:none;margin:8px 0;display:block}
        h1{color:#FAFAFA;font-size:36px;font-weight:600;margin-top:8px}
        .credits-container{margin-top:0;margin-bottom:10px}
        .credit-line{margin-bottom:4px}
        .credit-title,.credit-name{font-size:1.25rem;font-weight:400;color:#FAFAFA}
        .credit-name{color:#B3B3B3}
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
    </style>
    
    <!-- Minimal Bootstrap CSS - only used classes -->
    <link rel="stylesheet" href="css/bootstrap-minimal.css">
    
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/film.css">

</head>

    <body>
    <div class="wrapper">
        <nav>
			<button class="hamburger-menu" aria-label="Toggle navigation menu">
				<span></span>
				<span></span>
				<span></span>
			</button>
			<ul class="nav-list">
			  <li><a href="index.html">Films</a></li>
			  <li><a href="cast_crew.html">Cast &amp; Crew</a></li>
			  <li><a href="color_extractor.html">Color Extractor</a></li>
			  <li><a href="about.html">About</a></li>
			</ul>
			<form class="search-form" action="#" method="get">
                <input type="text" placeholder="Search by film or person..." name="search" class="search-input" id="search-input">
            </form>
		</nav>
        
        <h1 id="movie-title">Loading Film Gallery...</h1>
        <noscript>
            <p>This page requires JavaScript to display film content. Please enable JavaScript in your browser.</p>
        </noscript>
        
        <!-- Film description - provides text content for crawlers -->
        <div id="film-description" class="film-description">
            <p>Explore this curated collection of high-quality film screencaptures showcasing the artistry of cinema through composition, lighting, and color. Each still captures a moment of visual storytelling from this acclaimed motion picture.</p>
        </div>
        
        <div class="credits-container">
            <div class="credit-line">
                <span class="credit-title">Director:</span>
                <span class="credit-name" id="director">Loading...</span>
            </div>
            <div class="credit-line">
                <span class="credit-title">Cinematographer:</span>
                <span class="credit-name" id="cinematographer">Loading...</span>
            </div>
			<div class="credit-line">
                <span class="credit-title">Cast:</span>
                <span class="credit-name" id="cast">Loading...</span>
            </div>
        </div>
        <!-- Search Results Section -->
        <h4 class="search-results-header" style="display: none; margin-top: 10px;">Search Results:</h4>
        <div class="section-header" id="search-results-section" style="display: none;">
            <h4 class="search-results-header">Search Results:</h4>
            <div class="view-options">
                <div class="histogram-container">
                    <button class="histogram-bar" data-value="2" aria-label="2 items per row"></button>
                    <button class="histogram-bar" data-value="3" aria-label="3 items per row"></button>
                    <button class="histogram-bar" data-value="4" aria-label="4 items per row"></button>
                    <button class="histogram-bar" data-value="5" aria-label="5 items per row"></button>
                    <button class="histogram-bar" data-value="6" aria-label="6 items per row"></button>
                </div>
            </div>
        </div>
        <div class="image-container" id="film-cards-container" style="display: none;">
        </div>

        <!-- Main Image -->
        <div class="mt-3" id="main-content">
            <div class="main-image-container">
                <img id="main-image" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Loading film still" class="img-fluid main-image-placeholder" loading="eager" fetchpriority="high">
                <div class="image-click-indicators">
                    <div class="click-indicator left-indicator">
                        <span class="indicator-icon">‹</span>
                        <span class="indicator-text">Previous</span>
                    </div>
                    <div class="click-indicator middle-indicator">
                        <span class="indicator-icon">+</span>
                        <span class="indicator-text">Zoom</span>
                    </div>
                    <div class="click-indicator right-indicator">
                        <span class="indicator-icon">›</span>
                        <span class="indicator-text">Next</span>
                    </div>
                </div>
                <div class="swipe-tutorial" id="swipe-tutorial">
                    <div class="swipe-hand">
                        <svg class="hand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"></path>
                            <path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"></path>
                            <path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path>
                            <path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path>
                        </svg>
                        <div class="swipe-arrow">→</div>
                    </div>
                    <div class="swipe-instruction">Swipe to browse</div>
                </div>
            </div>
            <div id="main-palette-container" class="row no-gutters"></div>
        </div>
		
		<p id="thumbnail-instructions">Click one of the thumbnails below to select a main image.</p>
		
		<!-- Top Slider Controls (for mobile) -->
		<div class="slider-controls slider-controls-top">
			<div class="slider-indicators" id="slider-indicators-top"></div>
			<span class="slider-hint">Click a side to show more images.</span>
		</div>
		
        <!-- Thumbnail Grid -->
		<div class="thumbnail-grid-wrapper">
			<div class="row thumbnail-grid" id="thumbnail-grid">
				<!-- Film stills will load here -->
        </div>
		</div>
		
		<!-- Bottom Slider Controls -->
		<div class="slider-controls slider-controls-bottom">
			<div class="slider-indicators" id="slider-indicators-bottom"></div>
			<span class="slider-hint">Click a side to show more images.</span>
		</div>
    </div>
    <footer>
        <hr>
        <p>by Yuri Dandashi | <a href="about.html">About</a></p>
    </footer>
    <div id="zoom-overlay" class="zoom-overlay">
        <span class="close-zoom">&times;</span>
        <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Loading film still" class="zoomed-image" id="zoomed-image">
    </div>
    <script src="js/hamburger-menu.js"></script>
    <script src="js/clean-urls.js"></script>
    <script src="js/color-palette.js"></script>
    <script src="js/lazy-load.js"></script>
    <script src="js/thumbnail-slider.js"></script>
    <script src="js/swipe-handler.js"></script>
    <script src="utils/utils-http.js"></script>
    <script src="utils/utils-csv.js"></script>
    <script src="js/load-csv.js"></script>
    <script src="utils/utils-cache.js"></script>
    <script src="utils/utils-tmdb.js"></script>
    <script src="js/load-films.js"></script>
        <script>
        // CRITICAL: Update page metadata IMMEDIATELY on load (synchronous, before any async operations)
        // This ensures Google sees unique content for each film page
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get('id');
            
            if (!movieId) {
                // No movie ID - show error immediately
                document.getElementById('page-title').textContent = 'Error: No Film Specified | Scene Still';
                document.getElementById('meta-description').content = 'Film not found. Please select a film from the gallery.';
                document.getElementById('movie-title').textContent = 'Error: No film ID provided in URL';
                
                // Add basic structured data to prevent soft 404
                const errorData = {
                    "@context": "https://schema.org",
                    "@type": "WebPage",
                    "name": "Film Not Found",
                    "description": "The requested film page could not be loaded."
                };
                document.getElementById('initial-structured-data').textContent = JSON.stringify(errorData);
                return;
            }
            
            // Update title immediately with movie ID to make each page unique
            document.getElementById('page-title').textContent = `Film ${movieId} Gallery | Scene Still`;
            document.getElementById('meta-description').content = `High quality film screencaptures from this cinema masterpiece. View stunning stills, cinematography, and visual artistry.`;
            document.getElementById('movie-title').textContent = `Loading Film ${movieId}...`;
            
            // Set canonical URL immediately
            const canonicalUrl = `https://www.scenestill.com/film?id=${movieId}`;
            document.getElementById('canonical-url').setAttribute('href', canonicalUrl);
            
            // Add basic structured data immediately - will be replaced with full data when loaded
            const basicStructuredData = {
                "@context": "https://schema.org",
                "@type": "ImageGallery",
                "name": `Film Gallery - Movie ${movieId}`,
                "description": `High quality screencaptures and film stills from movie ${movieId}`,
                "url": canonicalUrl
            };
            document.getElementById('initial-structured-data').textContent = JSON.stringify(basicStructuredData);
            
            // Update Open Graph tags immediately
            document.getElementById('og-url').setAttribute('content', canonicalUrl);
            document.getElementById('og-title').setAttribute('content', `Film ${movieId} Gallery | Scene Still`);
            document.getElementById('twitter-url').setAttribute('content', canonicalUrl);
            document.getElementById('twitter-title').setAttribute('content', `Film ${movieId} Gallery | Scene Still`);
        })();
        
        async function populateMoviePage() {
            const urlParams = new URLSearchParams(window.location.search);
            const TMDB_MOVIE_ID = urlParams.get('id');

            if (!TMDB_MOVIE_ID) {
                // Error already handled in synchronous block above
                return;
            }

            if (!window.SZ || !window.SZ.tmdb) {
                document.getElementById('movie-title').textContent = 'Error: TMDb utils not loaded';
                return;
            }

            try {
                const movieDetails = await window.SZ.tmdb.getMovieDetails(TMDB_MOVIE_ID);
                if (!movieDetails) {
                    document.getElementById('movie-title').textContent = 'Movie not found on TMDb';
                    document.getElementById('page-title').textContent = 'Film Not Found | Scene Still';
                    document.getElementById('meta-description').content = 'The requested film could not be found in our database.';
                    return;
                }

                document.getElementById('page-title').textContent = movieDetails.title + ' | Scene Still';
                document.getElementById('meta-description').content = movieDetails.title + ' – handpicked high quality film screencaptures';
                document.getElementById('movie-title').textContent = `${movieDetails.title} (${new Date(movieDetails.release_date).getFullYear()})`;
                
                // Update film description with specific content
                const descriptionEl = document.getElementById('film-description');
                if (descriptionEl && movieDetails.overview) {
                    descriptionEl.innerHTML = `<p>${movieDetails.overview}</p>`;
                } else if (descriptionEl) {
                    descriptionEl.innerHTML = `<p>Handpicked high-quality screencaptures from ${movieDetails.title}, showcasing the film's visual artistry and cinematography.</p>`;
                }

                // Load stills from CSV first to get the first image for Open Graph
                const csvData = await window.SZ.utils.loadCsv('Scene still DB - Sheet1.csv');
                const movieEntry = csvData.find(row => row['Movie ID'] === String(TMDB_MOVIE_ID));

                let localStills = [];
                if (movieEntry && movieEntry.Stills) {
                    localStills = movieEntry.Stills.split('|');
                }

                // Update Open Graph tags
                const currentUrl = window.location.href;
                const ogTitle = `${movieDetails.title} (${new Date(movieDetails.release_date).getFullYear()})`;
                const ogDescription = `Handpicked high quality film screencaptures from ${movieDetails.title}. Explore the visual language of cinema through composition, light, and color.`;
                const ogImage = localStills.length > 0 ? localStills[0] : (movieDetails.poster_path ? `https://image.tmdb.org/t/p/original${movieDetails.poster_path}` : '');

                // Set canonical URL
                document.getElementById('canonical-url').setAttribute('href', currentUrl);
                
                document.getElementById('og-type').setAttribute('content', 'website');
                document.getElementById('og-url').setAttribute('content', currentUrl);
                document.getElementById('og-title').setAttribute('content', ogTitle);
                document.getElementById('og-description').setAttribute('content', ogDescription);
                document.getElementById('og-image').setAttribute('content', ogImage);

                document.getElementById('twitter-card').setAttribute('content', 'summary_large_image');
                document.getElementById('twitter-url').setAttribute('content', currentUrl);
                document.getElementById('twitter-title').setAttribute('content', ogTitle);
                document.getElementById('twitter-description').setAttribute('content', ogDescription);
                document.getElementById('twitter-image').setAttribute('content', ogImage);


                // Initialize search functionality
                window.SZ.searchManager.initializeSearch({
                    searchInputId: 'search-input',
                    filmCardsContainerId: 'film-cards-container',
                    mainContentSelector: '#main-content, #thumbnail-grid, .credits-container, .wrapper > h1, #thumbnail-instructions, .slider-controls-top, .slider-controls-bottom, #film-description'
                });

                // Director (assuming director is in crew)
                const director = movieDetails.credits?.crew?.find(person => person.job === 'Director');
                if (director) {
                    document.getElementById('director').innerHTML = `<a href="person.html?name=${encodeURIComponent(director.name)}&role=Director">${director.name}</a>`;
                } else {
                    document.getElementById('director').textContent = 'N/A';
                }

                // Cinematographer (Director of Photography)
                const cinematographer = movieDetails.credits?.crew?.find(person => person.job === 'Director of Photography');
                if (cinematographer) {
                    document.getElementById('cinematographer').innerHTML = `<a href="person.html?name=${encodeURIComponent(cinematographer.name)}&role=Cinematographer">${cinematographer.name}</a>`;
                } else {
                    document.getElementById('cinematographer').textContent = 'N/A';
                }

                // Cast
                const castContainer = document.getElementById('cast');
                const mainCast = movieDetails.credits?.cast?.slice(0, 5); // Get top 5 cast members
                if (mainCast && mainCast.length > 0) {
                    castContainer.innerHTML = mainCast.map(person => `<a href="person.html?name=${encodeURIComponent(person.name)}&role=Actor">${person.name}</a>`).join(', ');
                } else {
                    castContainer.textContent = 'N/A';
                }

                // Set aspect ratio for main image
                let aspectRatio = null;
                if (movieEntry && movieEntry['Aspect ratio']) {
                    aspectRatio = movieEntry['Aspect ratio'];
                    document.getElementById('main-image').style.aspectRatio = aspectRatio;
                }

                let compressedStills = [];
                if (movieEntry && movieEntry['Stills compressed']) {
                    compressedStills = movieEntry['Stills compressed'].split('|');
                }

                if (localStills.length > 0) {
                    const mainImage = document.getElementById('main-image');
                    // PRIORITY 1: Load main image at full resolution immediately
                    mainImage.src = localStills[0];
                    mainImage.alt = `${movieDetails.title} 1`;
                    // SEO: Add structured data attributes to main image
                    mainImage.setAttribute('itemprop', 'image');
                } else {
                    document.getElementById('main-image').src = ''; // Placeholder or error image
                }

                // Thumbnails
                const grid = document.getElementById('thumbnail-grid');
                grid.innerHTML = '';
                localStills.forEach((still, index) => {
                    const col = document.createElement('div');
                    col.className = 'col-lg-3 col-md-4 col-6 mb-4'; // lg-3: 4 cols on desktop, md-4: 3 cols on tablets, col-6: 2 cols on mobile
                    const wrap = document.createElement('div');
                    wrap.className = 'thumbnail-wrapper';
                    
                    const img = document.createElement('img');
                    
                    // PRIORITY 2: Use placeholder for all thumbnails, lazy load compressed versions
                    img.src = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
                    img.className = 'thumbnail-image';
                    img.dataset.lazySrc = compressedStills[index] || still; // Compressed version for initial load
                    img.dataset.fullSrc = still; // Full resolution for later upgrade
                    img.alt = `${movieDetails.title} ${index + 1}`;
                    img.loading = 'lazy'; // Browser-level lazy loading hint
                    
                    // Set aspect ratio on image to match main image approach
                    if (aspectRatio) {
                        img.style.aspectRatio = aspectRatio;
                    }
                    
                    // Don't add srcset - we'll handle loading manually through lazy-load.js
                    
                    // SEO: Add itemprop for schema.org ImageObject
                    img.setAttribute('itemprop', 'image');
                    
                    wrap.appendChild(img);
                    col.appendChild(wrap);
                    grid.appendChild(col);
                });

                // Get custom slider rows configuration from CSV if specified
                let customSliderRows = null;
                if (movieEntry && movieEntry['Slider rows']) {
                    const parsedRows = parseInt(movieEntry['Slider rows'], 10);
                    if (!isNaN(parsedRows) && parsedRows > 0) {
                        customSliderRows = parsedRows;
                    }
                }

                // Initialize slider if needed (more than 16 images)
                if (window.SZ?.thumbnailSlider?.initializeSlider) {
                    window.SZ.thumbnailSlider.initializeSlider(localStills.length, customSliderRows);
                }

                // Setup lazy loading for thumbnails
                if (window.SZ?.lazyLoad?.setupThumbnails) {
                    window.SZ.lazyLoad.setupThumbnails(localStills.length);
                }

                // Initialize color palette after images are set
                const mainImageElement = document.getElementById('main-image');
                const firstThumbnailWrapper = grid.querySelector('.thumbnail-wrapper');
                if (mainImageElement && firstThumbnailWrapper && window.SZ?.colorPalette?.updateMainImageAndPalette) {
                    window.SZ.colorPalette.updateMainImageAndPalette(mainImageElement.src, firstThumbnailWrapper);
                }

                // Initialize swipe handler with all image URLs
                if (window.SZ?.swipeHandler?.initializeSwipe) {
                    window.SZ.swipeHandler.initializeSwipe(localStills, customSliderRows);
                }

                // SEO: Add JSON-LD structured data for better Google Images indexing
                const structuredData = {
                    "@context": "https://schema.org",
                    "@type": "ImageGallery",
                    "name": `${movieDetails.title} (${new Date(movieDetails.release_date).getFullYear()}) - Film Stills`,
                    "description": `High quality screencaptures from ${movieDetails.title}`,
                    "url": currentUrl,
                    "about": {
                        "@type": "Movie",
                        "name": movieDetails.title,
                        "datePublished": movieDetails.release_date,
                        "identifier": TMDB_MOVIE_ID
                    },
                    "image": localStills.map((still, index) => ({
                        "@type": "ImageObject",
                        "contentUrl": still,
                        "name": `${movieDetails.title} ${index + 1}`,
                        "description": `Scene still ${index + 1} from ${movieDetails.title}`,
                        "thumbnail": compressedStills[index] || still
                    }))
                };
                
                // Replace initial structured data with full data
                document.getElementById('initial-structured-data').textContent = JSON.stringify(structuredData);

            } catch (err) {
                document.getElementById('movie-title').textContent = 'Error loading movie data from TMDb';
                document.getElementById('page-title').textContent = 'Error Loading Film | Scene Still';
                console.error(err);
            }
        }
        window.addEventListener('DOMContentLoaded', populateMoviePage);
        </script>
</body>
</html>
